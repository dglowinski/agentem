<div id="filterSearchCard">
  <form #myForm="ngForm" class="example-form">
    <md-input-container>
      <input places-auto-complete autofocus type="text" autocorrect="off" autocapitalize="off" spellcheck="off" #addressSearchBox
        [(ngModel)]="filter.address" id="addressSearchBox" name="address" (click)="this.addressSearchBox.value = ''" mdInput
        placeholder="Search by Street, Neighborhood or City" (place_changed)="placeChanged($event)" [types]="['geocode']" [componentRestrictions]='{country: "br"}'
      />
    </md-input-container>

    <ng-template #typesBRN>
      <md-radio-group class="example-radio-group" name="typesBRN" (change)="filterChanged()" (click)="$event.stopPropagation()"
        [(ngModel)]="filter.typesBRN">
        <md-radio-button class="example-radio-button" value="sale">
          Sale
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="rental">
          Rental
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="new">
          New Development
        </md-radio-button>
      </md-radio-group>
    </ng-template>

    <button md-raised-button placement="bottom" #p4="ngbPopover" (document:click)="p4.close()" (click)="$event.stopPropagation();p1.close();p2.close();p3.close()"
      [ngbPopover]="typesBRN"><i class="fa fa-handshake-o" aria-hidden="true"></i>
    </button>

    <ng-template #priceRange>
      <table class="example-full-width" cellspacing="0" (click)="$event.stopPropagation()">
        <tr>
          <td>
            <md-input-container class="example-full-width">
              <input mdInput placeholder="Min Price" [(ngModel)]="filter.minPrice" [formControl]="minPriceControl" pattern="\d+" name="minPrice">
              <md-error>Please enter number</md-error>
            </md-input-container>
          </td>
          <td>
            <md-input-container class="example-full-width">
              <input mdInput placeholder="Max Price" [(ngModel)]="filter.maxPrice" [formControl]="maxPriceControl" pattern="\d+" name="maxPrice">
              <md-error>Please enter number</md-error>
            </md-input-container>
          </td>
        </tr>
      </table>
    </ng-template>

    <button md-raised-button placement="bottom" #p1="ngbPopover" (document:click)="p1.close()" (click)="$event.stopPropagation();p2.close();p3.close();p4.close()"
      [ngbPopover]="priceRange">R$
    </button>

    <ng-template #beds>
      <md-radio-group class="example-radio-group" name="bedrooms" (change)="filterChanged()" (click)="$event.stopPropagation()"
        [(ngModel)]="filter.bedrooms">
        <md-radio-button class="example-radio-button" value="0">
          Studio+
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="1">
          1+
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="2">
          2+
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="3">
          3+
        </md-radio-button>
        <md-radio-button class="example-radio-button" value="4">
          4+
        </md-radio-button>
      </md-radio-group>
    </ng-template>

    <button md-raised-button placement="bottom" #p2="ngbPopover" (document:click)="p2.close()" (click)="$event.stopPropagation();p1.close();p3.close();p4.close()"
      [ngbPopover]="beds"><i class="fa fa-bed" aria-hidden="true"></i>
    </button>

    <ng-template #propertyType>
      <section class="example-section" (click)="$event.stopPropagation()">
        <md-checkbox class="example-margin" name="apartment" (change)="filterChanged()" [(ngModel)]="filter.propertyType.apartment">Apartment</md-checkbox>
        <md-checkbox class="example-margin" name="house" (change)="filterChanged()" [(ngModel)]="filter.propertyType.house">House</md-checkbox>
        <md-checkbox class="example-margin" name="villa" (change)="filterChanged()" [(ngModel)]="filter.propertyType.villa">Villa</md-checkbox>
      </section>
    </ng-template>

    <button md-raised-button placement="bottom" #p3="ngbPopover" (document:click)="p3.close()" (click)="$event.stopPropagation();p1.close();p2.close();p4.close()"
      [ngbPopover]="propertyType"><i class="fa fa-building-o" aria-hidden="true"></i>
    </button>

    <button md-raised-button color="primary" (click)="saveSearch()">{{saveSearchButton}}</button> 
    
    Found: {{listingService.listingCount}} matches

    <div *ngIf="listingService.isLoading" class="spinner-container">
      <i class="fa fa-cog fa-spin fa-2x fa-fw spin-cog"></i>
    </div>

    <div *ngIf="listingService.addressComponents.length" id="address-breadcrumbs ">
      <span *ngFor="let component of listingService.addressComponents; let j = index; let isLast = last">
        <a  href="#" (click)="$event.preventDefault(); clickBreadCrumbs(j)" class="font-smaller">
          {{component}}
        </a>
        <i class='fa fa-caret-right' *ngIf="!isLast"></i>
      </span>
    </div>
  </form>
</div>
